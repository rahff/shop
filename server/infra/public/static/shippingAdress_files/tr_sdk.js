var tdconvObj = {}, srcName = "tr_sdk.js?", queryString = getSrcQueryString(srcName), params = parseQuery(queryString), directLink = !1; if (tdconvObj.element = "iframe", params.org && (tdconvObj.orgId = params.org), params.dr && (tdconvObj.dr = !0), params.prog && (tdconvObj.program = !0, tdconvObj.programId = params.prog), 1 == tdconvObj.program && 1 == tdconvObj.dr && (loadRTag("rd-jssdk"), window.rdAsyncInit = function () { RD.init({ merchant_id: tdconvObj.programId }) }), "loading" !== document.readyState) { if (getQueryString("deviceid")) var tduid = getQueryString("deviceid"); else var tduid = getQueryString("tduid"); processSetTduid(tduid), getQueryString("directLink") && fireTDClk(tdconvObj.programId) } else document.addEventListener("DOMContentLoaded", (function () { if (getQueryString("deviceid")) var e = getQueryString("deviceid"); else e = getQueryString("tduid"); processSetTduid(e), getQueryString("directLink") && fireTDClk(tdconvObj.programId) })); function getSrcQueryString(e) { for (var t = document.getElementsByTagName("script"), r = 0; r < t.length; r++)if (t[r].src.indexOf(e, 0) > 0) return t[r].src.replace(/^[^\?]+\??/, ""); return null } function loadRTag(e) { if (document.getElementById(e)) console.log(e + "exists"); else { var t = new Date; t.setMinutes(0), t.setSeconds(0); var r = "https://datar.tradedoubler.com/js/td-rd-o-sdk.js?t=" + parseInt(t.getTime() / 1e3), n = document.createElement("script"); n.setAttribute("src", r), document.head.appendChild(n) } } function parseQuery(e) { var t = new Object; if (!e) return t; for (var r = e.split(/[;&]/), n = 0; n < r.length; n++) { var o = r[n].split("="); if (o && 2 == o.length) { var d = unescape(o[0]), a = unescape(o[1]); a = a.replace(/\+/g, " "), t[d] = a } } return t } function generateRandomOrderNumber() { return (new Date).valueOf() + Math.random() } function getQueryString(e) { try { var t = new URLSearchParams(window.location.search); value = t.get(e) } catch (t) { try { value = getUrlParameter(e) } catch (e) { return !1 } } return value } function getTduid() { var e = ""; return getCookie("tduid") ? e = getCookie("tduid") : getLocalStorage("tduid") && (e = getLocalStorage("tduid")), e } function getLocalStorage(e) { return window.localStorage.getItem(e) } function getCookie(e) { for (var t = e + "=", r = document.cookie.split(";"), n = 0; n < r.length; n++) { try { var o = decodeURIComponent(r[n]) } catch (e) { checkDebug() && console.log("Cannot URIDecode: " + r[n] + e.message); continue } for (; " " == o.charAt(0);)o = o.substring(1); if (0 == o.indexOf(t)) return o.substring(t.length, o.length) } return !1 } function getUrlParameter(e) { e = e.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]"); var t = new RegExp("[\\?&]" + e + "=([^&#]*)").exec(location.search); return null === t ? "" : decodeURIComponent(t[1].replace(/\+/g, " ")) } function processSetTduid(e) { if (null == e) return !1; try { setDomainCookie("tduid", e) } catch (e) { console.log(e) } finally { setCookie("tduid", e), setTduidLocalStorage(e) } } function setCookie(e, t) { var r = new Date; r.setTime(r.getTime() + 31536e6); var n = "expires=" + r.toUTCString(); document.cookie = e + "=" + t + ";" + n + ";path=/;sameSite=none;Secure=true" } function setDomainCookie(e, t) { var r = window.location.host.substr(window.location.host.indexOf(".")), n = new Date; n.setTime(n.getTime() + 31536e6); var o = "expires=" + n.toUTCString(); document.cookie = e + "=" + t + ";" + o + ";domain=" + r + ";path=/;sameSite=none;Secure=true" } function setDebug(e) { var t = "Disabled"; 1 == e && (t = "Enabled"), console.log("Tradedoubler Tracking SDK Debug Mode " + t + "!"), window.localStorage.setItem("debug", e) } function checkDebug() { var e = !1; return getLocalStorage("debug") && (e = "true" === getLocalStorage("debug")), e } function getUrlParameter(e) { e = e.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]"); var t = new RegExp("[\\?&]" + e + "=([^&#]*)").exec(location.search); return null === t ? "" : decodeURIComponent(t[1].replace(/\+/g, " ")) } function setTduidLocalStorage(e) { window.localStorage.setItem("tduid", e) } function fireTDTag(e, t, r, n) { if (1 != r) { if ("lead" == e || "sale" == e) try { if (!1 !== t.indexOf("tradedoubler.com")) var o = t.replace("tradedoubler.com", "pvnsolutions.com"); else if (!1 !== t.indexOf("pvnsolutions.com")) o = t; void 0 !== o && navigator.sendBeacon(o) } catch (e) { console.log("Send Beacon not working!" + e) } var d = document.createElement(n); return d.src = t + "&type=" + n, d.async = "yes", d.width = "1", d.height = "1", d.frameBorder = "0", void document.body.appendChild(d) } console.log("Tradedoubler Tracking SDK Debug Mode! Element:" + n + "! Event: " + e + "! URL: " + t) } function fireTDClk(e) { if (getQueryString("prog")) var t = getQueryString("prog"); else { if (!e) return console.log("No program Id set"), !1; t = e } if (!getQueryString("aff")) return console.log("No affiliate Id set"), !1; var r = "//clk.tradedoubler.com/click?p=" + t + "&a=" + getQueryString("aff") + "&f=0", n = document.createElement("iframe"); n.id = "tdClk", n.src = r, n.async = "yes", n.width = "1", n.height = "1", document.body.appendChild(n) } function processQueue(e) { "init" == e[0] && (tdconvObj.debug = checkDebug(), tdconvObj.orgId = e[1], null != e[2] && ("img" == e[2].element && (tdconvObj.element = "img"), e[2].program ? (tdconvObj.program = !0, tdconvObj.programId = e[2].programId) : tdconvObj.program = !1)), "debug" != e[0] ? "track" != e[0] ? "lp" != e[0] || landingPage(e[1], e[2]) : trackEvent(e[1], e[2]) : "boolean" == typeof e[1] && (setDebug(e[1]), tdconvObj.debug = e[1]) } function validateExtIdHash(e) { return !!/^[a-f0-9]{64}$/gi.test(e) || (console.warn("The extId for Cross Device Tracking is not a valid SHA-256 Hash, please review: " + e), !1) } function validateValidOn(e) { return !!/^\d{4}\-\d{2}\-\d{2}$/.test(e) || (console.warn("ValidOn not valid: " + e), !1) } function trackEvent(e, t) { if (element = "", "iframe" == tdconvObj.element && (element = "&type=iframe"), "lead" == e) { var r = generateRandomOrderNumber(), n = 4; void 0 !== t.transactionId && (r = t.transactionId), void 0 !== t.event && (n = t.event); var o = "https://tbl.tradedoubler.com/report?"; tdconvObj.program && (o = o + "program=" + tdconvObj.programId + "&"), o = o + "organization=" + tdconvObj.orgId + "&event=" + n + "&leadnumber=" + r + element + "&tduid=" + tdconvObj.tduid } else if ("sale" == e) { var d = generateRandomOrderNumber(), a = (n = 5, 0), i = "", c = "", u = "", g = "", l = "", s = ""; void 0 !== t.transactionId && (d = t.transactionId), void 0 !== t.event && (n = t.event), void 0 !== t.ordervalue && (a = t.ordervalue), void 0 !== t.currency && (i = "&currency=" + t.currency), void 0 !== t.voucher && (c = "&voucher=" + t.voucher), void 0 !== t.validOn && validateValidOn(t.validOn) && (g = "&validOn=" + t.validOn), void 0 !== t.cdt && validateExtIdHash(l) && (void 0 !== t.cdt.extId && (l = "&extid=" + t.cdt.extId), void 0 !== t.cdt.extType && (s = "&exttype=" + t.cdt.extType)), void 0 !== t.reportInfo && (u = "&reportInfo=" + t.reportInfo); o = "https://tbs.tradedoubler.com/report?"; tdconvObj.program && (o = o + "program=" + tdconvObj.programId + "&"), o = o + "organization=" + tdconvObj.orgId + "&event=" + n + "&ordervalue=" + a + "&ordernumber=" + d + i + c + l + s + g + "&tduid=" + tdconvObj.tduid + u } fireTDTag(e, o, tdconvObj.debug, tdconvObj.element) } tdconvObj.tduid = getTduid("tduid"); var tdQueue = tdconv.q; tdQueue && tdQueue.forEach((function (e) { processQueue(e) })); var tdconv = function (e, t, r) { "init" != e || (tdconvObj.orgId = t, tdconvObj.debug = checkDebug(), null == r || ("object" != typeof r && (r = JSON.parse(r)), "img" != r.element)) ? "debug" != e ? "track" != e || trackEvent(t, r) : "boolean" == typeof t && (setDebug(t), tdconvObj.debug = t) : tdconvObj.element = "img" };